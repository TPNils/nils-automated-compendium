<div class="{{@root.moduleName}}-attack">
  <div class="{{@root.moduleName}}-flavor">
    {{#if @root.data.calc$.roll.evaluated}}
      {{ localize (nacConcat "DND5E." (nacCapitalize @root.data.mode)) }}
    {{/if}}
  </div>
  <div class="{{@root.moduleName}}-roll-wrapper">
    {{#if @root.data.calc$.roll.evaluated }}
      <nac-roll-result 
        data-roll="{{nacToJsonString @root.data.calc$.roll}}"
        data-highlight-total-on-firstTerm="true"
        data-override-max-roll="{{@root.data.calc$.critTreshold}}">
      </nac-roll-result>
    {{else}}
      <div class="{{@root.moduleName}}-bonus-container">
        <button data-action="item-attack" class="{{@root.moduleName}}-item-attack" {{#nacMisPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}disabled{{/nacMisPerm}}>
          {{#if (eq @root.data.mode 'normal')}}
            {{#if @root.data.calc$.label}}{{@root.data.calc$.label}}{{else}}{{localize "DND5E.Attack"}}{{/if}}
          {{else}}
            {{ localize (nacConcat "DND5E." (nacCapitalize @root.data.mode)) }}
          {{/if}}
        </button>
        
        {{#if (and (eq @root.data.phase "bonus-input") (nacPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)) )}}
          <input class="{{@root.moduleName}}-bonus" placeholder="{{localize "DND5E.Bonus"}}: {{localize 'DND5E.RollExample'}}" type="text" value="{{@root.data.userBonus}}" data-action="item-attack-bonus" {{#nacMisPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}disabled{{/nacMisPerm}}/>
        {{/if}}
      </div>
    {{/if}}
    {{#nacPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}
      <div class="overlay">
        <div class="left">
          <button data-action="item-attack-mode-minus" class="{{@root.moduleName}}-mode-minus" {{#if (eq @root.data.mode 'disadvantage')}}disabled{{/if}}><i class="fas fa-minus"></i></button>
        </div>
        <div class="middel"></div>
        <div class="right">
          <button data-action="item-attack-mode-plus" class="{{@root.moduleName}}-mode-plus" {{#if (eq @root.data.mode 'advantage')}}disabled{{/if}}><i class="fas fa-plus"></i></button>
        </div>
      </div>
    {{/nacPerm}}
  </div>
</div>